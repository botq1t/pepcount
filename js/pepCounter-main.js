"use strict";let parametersDefault={timeBegin:0,timePauseStart:0,timePauseNow:0,timePause:0,timePassing:0};localStorage.pepcount_parameters||(localStorage.pepcount_parameters=JSON.stringify(parametersDefault));let parameters=JSON.parse(localStorage.pepcount_parameters);console.log("Parameters",parameters),localStorage.pepcount_mode||(localStorage.pepcount_mode="stop"),console.log(localStorage);let loggerDefault=[];localStorage.pepcount_logger||(localStorage.pepcount_logger=JSON.stringify(loggerDefault));let logger=JSON.parse(localStorage.pepcount_logger),words=["Значиць","Повторение","В принципе да","Кхе","Внимание","Это самое","Скажем","То есть","Вот"],counterDefault=[];for(let e=0;e<words.length;e++)$(".main__content").append(`\n\t\t<div id="card_${e}" class="main__card card">\n\t\t\t<h2 class="card__title">${words[e]}</h2>\n\t\t\t<div class="card__frequency frequency">\n\t\t\t\t<p class="freq-hour"><span>0</span>/ч</p>\n\t\t\t\t<p class="freq-minute"><span>0</span>/м</p>\n\t\t\t\t<p class="freq-second"><span>0</span>/с</p>\n\t\t\t</div>\n\t\t\t<div class="card__controls">\n\t\t\t\t<div class="card__button card__button_plus">+</div>\n\t\t\t\t<div class="card__displayer">0</div>\n\t\t\t\t<div class="card__button card__button_minus">-</div>\n\t\t\t</div>\n\t\t</div>\n\t`),counterDefault.push(0);localStorage.pepcount_counter||(localStorage.pepcount_counter=JSON.stringify(counterDefault));let timeCurrent,timePassing,intervalTimer,intervalPause,counter=JSON.parse(localStorage.pepcount_counter);function download(){let e=createLogText(),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","log"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function createLogText(){let e="{\n";e+="\twords: {\n";for(let t=0;t<words.length;t++)e+=`\t\t'${words[t]}': ${counter[t]},\n`;e+="\t},\n",e+=`\ttimePassed: ${timePassing},\n`,e+=`\ttimePassedString: '${getTimeString(timePassing)}',\n`,e+="\tlog: [\n";for(let t=0;t<logger.length;t++)e+=`\t\t${JSON.stringify(logger[t])},\n`;return e+="\t],\n",e+="}",console.log(e),e}function checkMode(e){switch(e){case"stop":localStorage.pepcount_parameters=JSON.stringify(parametersDefault),localStorage.pepcount_counter=JSON.stringify(counterDefault),localStorage.pepcount_logger=JSON.stringify(loggerDefault),parameters=JSON.parse(localStorage.pepcount_parameters),counter=JSON.parse(localStorage.pepcount_counter),logger=JSON.parse(localStorage.pepcount_logger),clearInterval(intervalTimer),clearInterval(intervalPause),$(".main__start").css("display","flex"),$("body").addClass("lock");break;case"start":$(".main__start").css("display","none"),$(".main__button_end").css("display","none"),$(".main__button_pause").html("Пауза"),$(".timer__begin").children("span").html(getTimeString(parameters.timeBegin)),$("body").removeClass("lock"),timer(),intervalTimer=setInterval(timer,1e3),clearInterval(intervalPause);break;case"pause":$(".main__start").css("display","none"),$(".main__button_end").css("display","flex"),$(".main__button_pause").html("Продолжить"),$(".timer__begin").children("span").html(getTimeString(parameters.timeBegin)),$(".timer__passing").children("span").html(getTimeString(parameters.timePassing)),$("body").removeClass("lock"),getPause(),timer(),getFrequency(parameters.timePassing),intervalPause=setInterval(getPause,500),intervalTimer=setInterval(timer,1e3)}}function timer(){let e=new Date;timeCurrent=3600*e.getHours()+60*e.getMinutes()+e.getSeconds(),timePassing=timeCurrent-parameters.timeBegin-parameters.timePauseNow,"start"==localStorage.pepcount_mode&&($(".timer__passing").children("span").html(getTimeString(timePassing)),getFrequency(timePassing))}function getTimeString(e){let t="",r=Math.floor(e/3600),o=Math.floor((e-3600*r)/60),n=Math.floor(e-3600*r-60*o);return r<10&&(t+="0"),t+=`${r}:`,o<10&&(t+="0"),t+=`${o}:`,n<10&&(t+="0"),t+=`${n}`,t}function getPause(){parameters.timePauseNow=parameters.timePause+(timeCurrent-parameters.timePauseStart)}function setCounter(e){e?$(`#card_${e}`).children(".card__controls").children(".card__displayer").html(counter[e]):$(".card").each((function(){let e=$(this).attr("id");e=e.split("_")[1],$(this).children(".card__controls").children(".card__displayer").html(counter[e])}))}function getFrequency(e){$(".card").each((function(){let t=$(this).attr("id");t=t.split("_")[1];let r={h:0,m:0,s:0};r.s=counter[t]/e,r.m=60*r.s,r.h=60*r.m,isNaN(r.s)&&(r.s=0,r.m=0,r.h=0),$(this).children(".frequency").children(".freq-hour").children("span").html(r.h.toFixed(2)),$(this).children(".frequency").children(".freq-minute").children("span").html(r.m.toFixed(2)),$(this).children(".frequency").children(".freq-second").children("span").html(r.s.toFixed(2))}))}function displayLogger(e){let t,r;switch(e){case"launch":$(".logger").empty(),t=1,$(".logger").prepend('<div class="logger__group" id="logger_1"></div>'),r=$(`#logger_${t}`),r.addClass("logger__group_green"),r.prepend(`<div class="logger__background">${t}</div>`);for(let e=0;e<logger.length;e++)e>0&&logger[e].time-logger[e-1].time>=10&&(t++,$(".logger").prepend(`<div class="logger__group" id="logger_${t}"></div>`),r=$(`#logger_${t}`),t%2?r.addClass("logger__group_green"):r.addClass("logger__group_yellow"),r.prepend(`<div class="logger__background">${t}</div>`)),addLogger(e,r);break;case"now":let e=logger.length-1;0==e?(t=1,$(".logger").prepend(`<div class="logger__group" id="logger_${t}"></div>`),r=$(`#logger_${t}`),r.addClass("logger__group_green"),r.prepend(`<div class="logger__background">${t}</div>`)):(t=$(".logger__group").first().attr("id"),t=t.split("_")[1],r=$(`#logger_${t}`)),e>0&&logger[e].time-logger[e-1].time>=10&&(t++,$(".logger").prepend(`<div class="logger__group" id="logger_${t}"></div>`),r=$(`#logger_${t}`),t%2?r.addClass("logger__group_green"):r.addClass("logger__group_yellow"),r.prepend(`<div class="logger__background">${t}</div>`)),addLogger(e,r)}}function addLogger(e,t){switch(logger[e].action){case"+":t.prepend(`<p><span class="logger__time">[${logger[e].timeString}]</span> ${logger[e].meaning} <span class="logger__blue">[${logger[e].counter}]</span></p>`);break;case"start":t.prepend(`<p><span class="logger__time">[${logger[e].timeString}]</span> <span class="logger__blue">Отсчёт начался</span></p>`);break;case"pause":t.prepend(`<p><span class="logger__time">[${logger[e].timeString}]</span> <span class="logger__blue">Пауза</span></p>`);break;case"resume":t.prepend(`<p><span class="logger__time">[${logger[e].timeString}]</span> <span class="logger__blue">Продолжение отсчёта</span></p>`)}}function setCardsOrder(e){for(let t=0;t<e.length;t++){let r=e[t];$(`#card_${t}`).css("order",""+-r)}}console.log("counter",counter),setCardsOrder(counter),checkMode(localStorage.pepcount_mode),displayLogger("launch"),setCounter(),$(".main__button_start").click((function(){localStorage.pepcount_mode="start",timer(),parameters.timeBegin=timeCurrent,localStorage.pepcount_parameters=JSON.stringify(parameters),checkMode(localStorage.pepcount_mode),logger.push({time:timeCurrent,timeString:getTimeString(timeCurrent),meaning:"start",action:"start"}),localStorage.pepcount_logger=JSON.stringify(logger),console.log("logger",logger),$(".logger").empty(),displayLogger("now")})),$(".main__button_pause").click((function(){switch($(this).html()){case"Пауза":localStorage.pepcount_mode="pause",parameters.timePauseStart=timeCurrent,parameters.timePassing=timeCurrent-parameters.timeBegin-parameters.timePauseNow,localStorage.pepcount_parameters=JSON.stringify(parameters),logger.push({time:timeCurrent,timeString:getTimeString(timeCurrent),meaning:"pause",action:"pause"}),localStorage.pepcount_logger=JSON.stringify(logger),console.log("logger",logger),displayLogger("now");break;case"Продолжить":localStorage.pepcount_mode="start",parameters.timePauseStart=0,parameters.timePause=parameters.timePauseNow,localStorage.pepcount_parameters=JSON.stringify(parameters),logger.push({time:timeCurrent,timeString:getTimeString(timeCurrent),meaning:"resume",action:"resume"}),localStorage.pepcount_logger=JSON.stringify(logger),console.log("logger",logger),displayLogger("now")}checkMode(localStorage.pepcount_mode)})),$(".main__button_end").click((function(){localStorage.pepcount_mode="stop",checkMode(localStorage.pepcount_mode),setCounter()})),$(".card__button_plus").click((function(){let e=$(this).parent().parent().attr("id");e=e.split("_")[1],counter[e]++,localStorage.pepcount_counter=JSON.stringify(counter),console.log(e),setCounter(e),logger.push({time:timeCurrent,counter:counter[e],timeString:getTimeString(timeCurrent),meaning:$(this).parent().prev().prev().html(),action:"+"}),localStorage.pepcount_logger=JSON.stringify(logger),displayLogger("now")})),$(".card__displayer").click((function(){let e=$(this).parent().parent().attr("id");e=e.split("_")[1],counter[e]++,localStorage.pepcount_counter=JSON.stringify(counter),console.log(e),setCounter(e),logger.push({time:timeCurrent,counter:counter[e],timeString:getTimeString(timeCurrent),meaning:$(this).parent().prev().prev().html(),action:"+"}),localStorage.pepcount_logger=JSON.stringify(logger),displayLogger("now")})),$(".card__title").click((function(){let e=$(this).parent().attr("id");e=e.split("_")[1],counter[e]++,localStorage.pepcount_counter=JSON.stringify(counter),console.log(e),setCounter(e),logger.push({time:timeCurrent,counter:counter[e],timeString:getTimeString(timeCurrent),meaning:$(this).html(),action:"+"}),localStorage.pepcount_logger=JSON.stringify(logger),displayLogger("now")})),$(".card__frequency").click((function(){let e=$(this).parent().attr("id");e=e.split("_")[1],counter[e]++,localStorage.pepcount_counter=JSON.stringify(counter),console.log(e),setCounter(e),logger.push({time:timeCurrent,counter:counter[e],timeString:getTimeString(timeCurrent),meaning:$(this).prev().html(),action:"+"}),localStorage.pepcount_logger=JSON.stringify(logger),displayLogger("now")})),$(".card__button_minus").click((function(){let e=$(this).parent().parent().attr("id");if(e=e.split("_")[1],0==counter[e])return;counter[e]--,localStorage.pepcount_counter=JSON.stringify(counter),console.log(e),setCounter(e);let t=$(this).parent().prev().prev().html();for(let e=logger.length-1;e>=0;e--)if(logger[e].meaning==t){logger.splice(e,1);break}localStorage.pepcount_logger=JSON.stringify(logger),displayLogger("launch")})),document.querySelector(".logger").addEventListener("dblclick",download);